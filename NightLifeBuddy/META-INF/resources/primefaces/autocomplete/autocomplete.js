PrimeFaces.widget.AutoComplete=PrimeFaces.widget.BaseWidget.extend({init:function(a){this._super(a);this.panelId=this.jqId+"_panel";this.input=$(this.jqId+"_input");this.hinput=$(this.jqId+"_hinput");this.panel=this.jq.children(this.panelId);this.dropdown=this.jq.children(".ui-button");this.disabled=this.input.is(":disabled");this.active=true;this.cfg.pojo=this.hinput.length==1;this.cfg.minLength=this.cfg.minLength!=undefined?this.cfg.minLength:1;this.cfg.delay=this.cfg.delay!=undefined?this.cfg.delay:300;this.cfg.cache=this.cfg.cache||false;if(this.cfg.cache){this.initCache()}this.input.data(PrimeFaces.CLIENT_ID_DATA,this.id);this.hinput.data(PrimeFaces.CLIENT_ID_DATA,this.id);if(!this.disabled){if(this.cfg.multiple){this.setupMultipleMode();this.multiItemContainer.data("primefaces-overlay-target",true).find("*").data("primefaces-overlay-target",true)}else{PrimeFaces.skinInput(this.input);this.input.data("primefaces-overlay-target",true).find("*").data("primefaces-overlay-target",true);this.dropdown.data("primefaces-overlay-target",true).find("*").data("primefaces-overlay-target",true)}this.bindStaticEvents();if(this.cfg.behaviors){PrimeFaces.attachBehaviors(this.input,this.cfg.behaviors)}if(this.cfg.forceSelection){this.setupForceSelection()}$(document.body).children(this.panelId).remove();this.panel.appendTo(document.body);if(this.cfg.itemtip){this.itemtip=$('<div id="'+this.id+'_itemtip" class="ui-autocomplete-itemtip ui-state-highlight ui-widget ui-corner-all ui-shadow"></div>').appendTo(document.body);this.cfg.itemtipMyPosition=this.cfg.itemtipMyPosition||"left top";this.cfg.itemtipAtPosition=this.cfg.itemtipAtPosition||"right bottom"}this.setupDialogSupport()}},initCache:function(){this.cache={};var a=this;this.cacheTimeout=setInterval(function(){a.clearCache()},this.cfg.cacheTimeout)},clearCache:function(){this.cache={}},setupMultipleMode:function(){var b=this;this.multiItemContainer=this.jq.children("ul");this.inputContainer=this.multiItemContainer.children(".ui-autocomplete-input-token");this.multiItemContainer.hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}).click(function(){b.input.focus()});this.input.focus(function(){b.multiItemContainer.addClass("ui-state-focus")}).blur(function(c){b.multiItemContainer.removeClass("ui-state-focus")});var a=this.jqId+" li.ui-autocomplete-token .ui-autocomplete-token-icon";$(document).off("click",a).on("click",a,null,function(c){b.removeItem(c,$(this).parent())})},setupDialogSupport:function(){var a=this.jq.parents(".ui-dialog:first");if(a.length==1){this.panel.css("position","fixed");if(this.cfg.itemtip){this.itemtip.css("position","fixed")}}},bindStaticEvents:function(){var a=this;this.bindKeyEvents();this.dropdown.mouseover(function(){if(!a.disabled){$(this).addClass("ui-state-hover")}}).mouseout(function(){if(!a.disabled){$(this).removeClass("ui-state-hover")}}).mousedown(function(){if(!a.disabled&&a.active){$(this).addClass("ui-state-active")}}).mouseup(function(){if(!a.disabled&&a.active){$(this).removeClass("ui-state-active");a.search("");a.input.focus()}}).focus(function(){$(this).addClass("ui-state-focus")}).blur(function(){$(this).removeClass("ui-state-focus")}).keydown(function(d){var c=$.ui.keyCode;if(d.which==c.ENTER||d.which==c.NUMPAD_ENTER){a.search("");a.input.focus();d.preventDefault()}});var b;$(document.body).bind("mousedown.ui-autocomplete",function(c){if(a.panel.is(":hidden")){return}b=a.panel.offset();if(c.target===a.input.get(0)){return}if(c.pageX<b.left||c.pageX>b.left+a.panel.width()||c.pageY<b.top||c.pageY>b.top+a.panel.height()){a.hide()}});this.resizeNS="resize."+this.id;this.unbindResize();this.bindResize()},bindResize:function(){var a=this;$(window).bind(this.resizeNS,function(b){if(a.panel.is(":visible")){a.alignPanel()}})},unbindResize:function(){$(window).unbind(this.resizeNS)},bindKeyEvents:function(){var a=this;this.input.keyup(function(g){var f=$.ui.keyCode,b=g.which,d=true;if(b==f.ESCAPE){a.hide();d=false}else{if(b==f.UP||b==f.LEFT||b==f.DOWN||b==f.RIGHT||b==f.TAB||b==f.SHIFT||b==f.ENTER||b==f.NUMPAD_ENTER){d=false}else{if(a.cfg.pojo&&!a.cfg.multiple){a.hinput.val($(this).val())}}}if(d){var c=a.input.val();if(!c.length){a.hide()}if(c.length>=a.cfg.minLength){if(a.timeout){clearTimeout(a.timeout)}a.timeout=setTimeout(function(){a.search(c)},a.cfg.delay)}}}).keydown(function(g){if(a.panel.is(":visible")){var f=$.ui.keyCode,d=a.items.filter(".ui-state-highlight");switch(g.which){case f.UP:case f.LEFT:var c=d.length==0?a.items.eq(0):d.prevAll(".ui-autocomplete-item:first");if(c.length==1){d.removeClass("ui-state-highlight");c.addClass("ui-state-highlight");if(a.cfg.scrollHeight){PrimeFaces.scrollInView(a.panel,c)}if(a.cfg.itemtip){a.showItemtip(c)}}g.preventDefault();break;case f.DOWN:case f.RIGHT:var b=d.length==0?a.items.eq(0):d.nextAll(".ui-autocomplete-item:first");if(b.length==1){d.removeClass("ui-state-highlight");b.addClass("ui-state-highlight");if(a.cfg.scrollHeight){PrimeFaces.scrollInView(a.panel,b)}if(a.cfg.itemtip){a.showItemtip(b)}}g.preventDefault();break;case f.ENTER:case f.NUMPAD_ENTER:d.click();g.preventDefault();break;case f.ALT:case 224:break;case f.TAB:d.trigger("click");a.hide();break}}})},bindDynamicEvents:function(){var a=this;this.items.bind("mouseover",function(){var b=$(this);if(!b.hasClass("ui-state-highlight")){a.items.filter(".ui-state-highlight").removeClass("ui-state-highlight");b.addClass("ui-state-highlight");if(a.cfg.itemtip){a.showItemtip(b)}}}).bind("click",function(d){var c=$(this),e=c.attr("data-item-value");if(a.cfg.multiple){var b='<li data-token-value="'+c.attr("data-item-value")+'"class="ui-autocomplete-token ui-state-active ui-corner-all ui-helper-hidden">';b+='<span class="ui-autocomplete-token-icon ui-icon ui-icon-close" />';b+='<span class="ui-autocomplete-token-label">'+c.attr("data-item-label")+"</span></li>";a.inputContainer.before(b);a.multiItemContainer.children(".ui-helper-hidden").fadeIn();a.input.val("").focus();a.hinput.append('<option value="'+e+'" selected="selected"></option>')}else{a.input.val(c.attr("data-item-label")).focus();if(a.cfg.pojo){a.hinput.val(e)}}a.invokeItemSelectBehavior(d,e);a.hide()})},showItemtip:function(b){var a=b.is("li")?b.next(".ui-autocomplete-itemtip-content"):b.children("td:last");this.itemtip.html(a.html()).css({left:"",top:"","z-index":++PrimeFaces.zindex,width:a.outerWidth()}).position({my:this.cfg.itemtipMyPosition,at:this.cfg.itemtipAtPosition,of:b}).show()},showSuggestions:function(c){this.items=this.panel.find(".ui-autocomplete-item");this.bindDynamicEvents();var e=this,b=this.panel.is(":hidden");if(b){this.show()}else{this.alignPanel()}if(this.items.length>0){var d=this.items.eq(0);d.addClass("ui-state-highlight");if(this.panel.children().is("ul")&&c.length>0){this.items.each(function(){var g=$(this),i=g.html(),f=new RegExp(PrimeFaces.escapeRegExp(c),"gi"),h=i.replace(f,'<span class="ui-autocomplete-query">$&</span>');g.html(h)})}if(this.cfg.forceSelection){this.currentItems=[];this.items.each(function(f,g){e.currentItems.push($(g).attr("data-item-label"))})}if(this.cfg.itemtip&&d.length===1){this.showItemtip(d)}}else{if(this.cfg.emptyMessage){var a='<div class="ui-autocomplete-emptyMessage ui-widget">'+this.cfg.emptyMessage+"</div>";this.panel.html(a)}else{this.panel.hide()}}},search:function(d){if(d===undefined||d===null){return}if(this.cfg.cache&&this.cache[d]){this.panel.html(this.cache[d]);this.showSuggestions(d);return}if(!this.active){return}var a=this;if(this.cfg.itemtip){this.itemtip.hide()}var c={source:this.id,process:this.id,update:this.id,formId:this.cfg.formId,onsuccess:function(j){var g=$(j.documentElement),h=g.find("update");for(var e=0;e<h.length;e++){var l=h.eq(e),k=l.attr("id"),f=l.get(0).childNodes[0].nodeValue;if(k===a.id){a.panel.html(f);if(a.cfg.cache){a.cache[d]=f}a.showSuggestions(d)}else{PrimeFaces.ajax.AjaxUtils.updateElement.call(this,k,f)}}PrimeFaces.ajax.AjaxUtils.handleResponse.call(this,g);return true}};c.params=[{name:this.id+"_query",value:d}];if(this.hasBehavior("query")){var b=this.cfg.behaviors.query;b.call(this,d,c)}else{PrimeFaces.ajax.AjaxRequest(c)}},show:function(){this.alignPanel();if(this.cfg.effect){this.panel.show(this.cfg.effect,{},this.cfg.effectDuration)}else{this.panel.show()}},hide:function(){this.panel.hide();this.panel.css("height","auto");if(this.cfg.itemtip){this.itemtip.hide()}},invokeItemSelectBehavior:function(b,d){if(this.cfg.behaviors){var c=this.cfg.behaviors.itemSelect;if(c){var a={params:[{name:this.id+"_itemSelect",value:d}]};c.call(this,b,a)}}},invokeItemUnselectBehavior:function(c,d){if(this.cfg.behaviors){var a=this.cfg.behaviors.itemUnselect;if(a){var b={params:[{name:this.id+"_itemUnselect",value:d}]};a.call(this,c,b)}}},removeItem:function(c,b){var d=b.attr("data-token-value"),a=this;this.hinput.children("option").filter('[value="'+d+'"]').remove();b.fadeOut("fast",function(){var e=$(this);e.remove();a.invokeItemUnselectBehavior(c,d)})},setupForceSelection:function(){this.currentItems=[this.input.val()];var a=this;this.input.blur(function(){var d=$(this).val(),c=false;for(var b=0;b<a.currentItems.length;b++){if(a.currentItems[b]===d){c=true;break}}if(!c){if(a.cfg.multiple){a.input.val("")}else{a.input.val("");a.hinput.val("")}}})},disable:function(){this.disabled=true;this.input.addClass("ui-state-disabled").attr("disabled","disabled")},enable:function(){this.disabled=false;this.input.removeClass("ui-state-disabled").removeAttr("disabled")},close:function(){this.hide()},deactivate:function(){this.active=false},activate:function(){this.active=true},hasBehavior:function(a){if(this.cfg.behaviors){return this.cfg.behaviors[a]!=undefined}return false},alignPanel:function(){var c=this.panel.css("position")=="fixed",d=$(window),b=c?"-"+d.scrollLeft()+" -"+d.scrollTop():null,f=null;if(this.cfg.multiple){f=this.multiItemContainer.innerWidth()-(this.input.position().left-this.multiItemContainer.position().left)}else{if(this.panel.is(":visible")){f=this.panel.children(".ui-autocomplete-items").outerWidth()}else{this.panel.css({visibility:"hidden",display:"block"});f=this.panel.children(".ui-autocomplete-items").outerWidth();this.panel.css({visibility:"visible",display:"none"})}var e=this.input.outerWidth();if(f<e){f=e}}if(this.cfg.scrollHeight){var a=this.panel.is(":hidden")?this.panel.height():this.panel.children().height();if(a>this.cfg.scrollHeight){this.panel.height(this.cfg.scrollHeight)}else{this.panel.css("height","auto")}}this.panel.css({left:"",top:"",width:f,"z-index":++PrimeFaces.zindex}).position({my:"left top",at:"left bottom",of:this.input,offset:b})}});