PrimeFaces.widget.TabView=PrimeFaces.widget.BaseWidget.extend({init:function(b){this._super(b);this.panelContainer=this.jq.children(".ui-tabs-panels");this.stateHolder=$(this.jqId+"_activeIndex");this.cfg.selected=parseInt(this.stateHolder.val());this.onshowHandlers=this.onshowHandlers||{};if(this.cfg.scrollable){this.navscroller=this.jq.children(".ui-tabs-navscroller");this.navcrollerLeft=this.navscroller.children(".ui-tabs-navscroller-btn-left");this.navcrollerRight=this.navscroller.children(".ui-tabs-navscroller-btn-right");this.navContainer=this.navscroller.children(".ui-tabs-nav");this.firstTab=this.navContainer.children(":first-child");this.lastTab=this.navContainer.children(":last-child");this.scrollStateHolder=$(this.jqId+"_scrollState")}else{this.navContainer=this.jq.children(".ui-tabs-nav")}this.bindEvents();if(this.cfg.dynamic&&this.cfg.cache){this.markAsLoaded(this.panelContainer.children().eq(this.cfg.selected))}if(this.cfg.scrollable){var d=this;if(this.jq.is(":not(:visible)")){var a=this.jq.parent().closest(".ui-hidden-container"),c=a.data("widget");if(c){c.addOnshowHandler(this.id,function(){return d.initScrolling()})}}else{this.initScrolling()}}},bindEvents:function(){var a=this;this.navContainer.children("li").on("mouseover.tabview",function(c){var b=$(this);if(!b.hasClass("ui-state-disabled")){b.addClass("ui-state-hover")}}).on("mouseout.tabview",function(c){var b=$(this);if(!b.hasClass("ui-state-disabled")){b.removeClass("ui-state-hover")}}).on("click.tabview",function(d){var c=$(this);if($(d.target).is(":not(.ui-icon-close)")){var b=c.index();if(!c.hasClass("ui-state-disabled")&&b!==a.cfg.selected){a.select(b)}}d.preventDefault()});this.navContainer.find("li .ui-icon-close").on("click.tabview",function(d){var b=$(this).parent().index();if(a.cfg.onTabClose){var c=a.cfg.onTabClose.call(a,b);if(c!==false){a.remove(b)}}else{a.remove(b)}d.preventDefault()});if(this.cfg.scrollable){this.navscroller.children(".ui-tabs-navscroller-btn").on("mouseover.tabview",function(){var b=$(this);if(!b.hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover")}}).on("mouseout.tabview",function(){var b=$(this);if(!b.hasClass("ui-state-disabled")){$(this).removeClass("ui-state-hover ui-state-active")}}).on("mousedown.tabview",function(){var b=$(this);if(!b.hasClass("ui-state-disabled")){$(this).removeClass("ui-state-hover").addClass("ui-state-active")}}).on("mouseup.tabview",function(){var b=$(this);if(!b.hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover").removeClass("ui-state-active")}});this.navcrollerLeft.on("click.tabview",function(b){a.scroll(100);b.preventDefault()});this.navcrollerRight.on("click.tabview",function(b){a.scroll(-100);b.preventDefault()})}},initScrolling:function(){if(this.jq.is(":visible")){var a=(this.lastTab.position().left-this.firstTab.position().left)>this.navscroller.innerWidth();if(a){this.navscroller.css("padding-left","18px");this.navcrollerLeft.show();this.navcrollerRight.show();this.restoreScrollState()}return true}else{return false}},scroll:function(c){if(this.navContainer.is(":animated")){return}var f=parseInt(this.navContainer.css("margin-left")),b=f+c,a=this.navscroller.innerWidth(),d=this;if(c<0){var e=this.lastTab.position().left+parseInt(this.lastTab.innerWidth());if(e>a){this.navContainer.animate({"margin-left":b+"px"},"fast","easeInOutCirc",function(){d.saveScrollState(b);if((e+c)<a){d.disableScrollerButton(d.navcrollerRight)}else{if(d.navcrollerLeft.hasClass("ui-state-disabled")){d.enableScrollerButton(d.navcrollerLeft)}}})}}else{if(b<=0){this.navContainer.animate({"margin-left":b+"px"},"fast","easeInOutCirc",function(){d.saveScrollState(b);if(b===0){d.disableScrollerButton(d.navcrollerLeft)}else{if(d.navcrollerRight.hasClass("ui-state-disabled")){d.enableScrollerButton(d.navcrollerRight)}}})}}},disableScrollerButton:function(a){a.addClass("ui-state-disabled").removeClass("ui-state-hover ui-state-active")},enableScrollerButton:function(a){a.removeClass("ui-state-disabled")},saveScrollState:function(a){this.scrollStateHolder.val(a)},restoreScrollState:function(){var a=parseInt(this.scrollStateHolder.val());if(a===0){this.disableScrollerButton(this.navcrollerLeft)}this.navContainer.css("margin-left",this.scrollStateHolder.val()+"px")},select:function(d,c){if(this.cfg.onTabChange&&!c){var a=this.cfg.onTabChange.call(this,d);if(a===false){return false}}var b=this.panelContainer.children().eq(d),e=this.cfg.dynamic&&!this.isLoaded(b);this.stateHolder.val(d);this.cfg.selected=d;if(e){this.loadDynamicTab(b)}else{this.show(b);if(this.hasBehavior("tabChange")&&!c){this.fireTabChangeEvent(b)}}return true},show:function(c){var f=this.navContainer.children(),e=f.filter(".ui-state-active"),b=f.eq(c.index()),d=this.panelContainer.children(".ui-tabs-panel:visible"),a=this;d.attr("aria-hidden",true);e.attr("aria-expanded",false);c.attr("aria-hidden",false);b.attr("aria-expanded",true);if(this.cfg.effect){d.hide(this.cfg.effect,null,this.cfg.effectDuration,function(){e.removeClass("ui-state-focus ui-tabs-selected ui-state-active");b.addClass("ui-state-focus ui-tabs-selected ui-state-active");c.show(a.cfg.effect,null,a.cfg.effectDuration,function(){a.postTabShow(c)})})}else{e.removeClass("ui-state-focus ui-tabs-selected ui-state-active");d.hide();b.addClass("ui-state-focus ui-tabs-selected ui-state-active");c.show();this.postTabShow(c)}},loadDynamicTab:function(b){var a=this,c={source:this.id,process:this.id,update:this.id},d=b.index();c.onsuccess=function(k){var h=$(k.documentElement),j=h.find("update");for(var f=0;f<j.length;f++){var m=j.eq(f),l=m.attr("id"),g=m.get(0).childNodes[0].nodeValue;if(l===a.id){b.html(g);if(a.cfg.cache){a.markAsLoaded(b)}}else{PrimeFaces.ajax.AjaxUtils.updateElement.call(this,l,g)}}PrimeFaces.ajax.AjaxUtils.handleResponse.call(this,h);return true};c.oncomplete=function(){a.show(b)};c.params=[{name:this.id+"_contentLoad",value:true},{name:this.id+"_newTab",value:b.attr("id")},{name:this.id+"_tabindex",value:d}];if(this.hasBehavior("tabChange")){var e=this.cfg.behaviors.tabChange;e.call(this,b,c)}else{PrimeFaces.ajax.AjaxRequest(c)}},remove:function(b){var d=this.navContainer.children().eq(b),a=this.panelContainer.children().eq(b);this.fireTabCloseEvent(a);d.remove();a.remove();if(b<this.cfg.selected){this.cfg.selected--}else{if(b===this.cfg.selected){var c=(this.cfg.selected===this.getLength())?this.cfg.selected-1:this.cfg.selected;this.select(c,true)}}},getLength:function(){return this.navContainer.children().length},getActiveIndex:function(){return this.cfg.selected},fireTabChangeEvent:function(a){var c=this.cfg.behaviors.tabChange,b={params:[{name:this.id+"_newTab",value:a.attr("id")},{name:this.id+"_tabindex",value:a.index()}]};c.call(this,a,b)},fireTabCloseEvent:function(a){if(this.hasBehavior("tabClose")){var c=this.cfg.behaviors.tabClose,b={params:[{name:this.id+"_closeTab",value:a.attr("id")},{name:this.id+"_tabindex",value:a.index()}]};c.call(this,null,b)}},hasBehavior:function(a){if(this.cfg.behaviors){return this.cfg.behaviors[a]!==undefined}return false},markAsLoaded:function(a){a.data("loaded",true)},isLoaded:function(a){return a.data("loaded")===true},disable:function(a){this.navContainer.children().eq(a).addClass("ui-state-disabled")},enable:function(a){this.navContainer.children().eq(a).removeClass("ui-state-disabled")},addOnshowHandler:function(b,a){this.onshowHandlers[b]=a},postTabShow:function(a){if(this.cfg.onTabShow){this.cfg.onTabShow.call(this,a.index())}for(var c in this.onshowHandlers){if(this.onshowHandlers.hasOwnProperty(c)){var b=this.onshowHandlers[c];if(b.call()){delete this.onshowHandlers[c]}}}}});